<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Adding direct editing of geometry fields in QGIS</title>
    <link rel="stylesheet" href="http://www.carsonfarmer.com/theme/css/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="http://www.carsonfarmer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Carson Farmer Atom Feed" />
    <link href="http://www.carsonfarmer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Carson Farmer RSS Feed" />
    <script type="text/javascript" src="//code.jquery.com/jquery-2.0.2.js"></script>
    <script src="http://www.carsonfarmer.com/libs/bootstrap-3.1.1/dist/js/bootstrap.min.js"></script>
</head> 

<body id="index" class="home">
<img id="bg" src="http://www.carsonfarmer.com/theme/images/bg/bg-1024.png" style="position: fixed; top: 0; left: 0;">
        <!-- <header id="banner" class="body"> -->
<nav class="navbar navbar-default navbar-fixed-top sticky shadow" role="navigation">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
<a class="brand" id="home" href="http://www.carsonfarmer.com/">
                <img src="http://www.carsonfarmer.com/theme/images/title.svg" id="title" class="svg"></img>
            </a>
	
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li>
              <a href="http://www.carsonfarmer.com/about/">
                  <i class="fa fa-info-circle"></i> About
              </a>
            </li>
            <li>
              <a href="http://www.carsonfarmer.com/curriculum-vitae/">
                  <i class="fa fa-rocket"></i> Curriculum&nbsp;Vitae
              </a>
            </li>
            <li>
              <a href="http://www.carsonfarmer.com/research/">
                  <i class="fa fa-globe"></i> Research
              </a>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <i class="fa fa-group"></i> Social <b class="caret"></b>
              </a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="http://www.carsonfarmer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">
                  <i class="fa fa-rss"></i> atom feed</a>
                </li>
                <li>
                  <a href="http://www.carsonfarmer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">
                  <i class="fa fa-rss"></i> rss feed</a>
                </li>
                <li class="divider"></li>
                <li>
                  <a href="https://twitter.com/CarsonFarmer"><i class="fa fa-twitter"></i> twitter</a>
                </li>
                <li>
                  <a href="https://github.com/cfarmer"><i class="fa fa-github"></i> github</a>
                </li>
                <li>
                  <a href="http://about.me/carson.farmer"><i class="fa fa-user"></i> about.me</a>
                </li>
                <li>
                  <a href="http://hunter-cuny.academia.edu/CarsonFarmer"><i class="fa fa-book"></i> academia.edu</a>
                </li>
                <li>
                  <a href="http://www.linkedin.com/pub/carson-farmer/40/3bb/27/"><i class="fa fa-linkedin"></i> linkedin</a>
                </li>
                <li>
                  <a href="https://plus.google.com/108062014159451325697/about/p/pub"><i class="fa fa-google-plus"></i> google+</a>
                </li>
                <li>
                  <a href="http://cuny.is/cfarmer"><i class="fa fa-comment-o"></i> cuny.is</a>
                </li>
                <li>
                  <a href="mailto:carson.farmer@gmail.com"><i class="fa fa-envelope"></i> email</a>
                </li>
              </ul>
            </li>
          </ul>
          <form class="navbar-search pull-right">
            <div class="input-append">
              <input type="search" class="form-control" id="top-query" placeholder="  ">
            <div class="dropdown pull-right" id="top-dropdown">
              <a class="dropdown-toggle" id="top-toggle" role="button" data-toggle="dropdown" data-target="#" href="."></a>
              <ul class="dropdown-menu pull-right" role="menu" id="top-results" aria-labelledby="top-toggle"></ul></div>
            </div>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>

        <!-- </header> -->
<section id="content" class="body">
  <article class="hentry shadow">
    <header>
      <h1 class="entry-title">
        <a href="http://www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/" rel="bookmark"
           title="Permalink to Adding direct editing of geometry fields in QGIS">Adding direct editing of geometry fields in <span class="caps">QGIS</span></a></h1>
      <abbr class="published" title="2011-03-12T18:43:00">
          <i class="fa fa-calendar"></i>
          Sat 12 March 2011
      </abbr>
<div class="share-list">
<a href="http://twitter.com/share?url=http%3A//www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/&text=Adding%20direct%20editing%20of%20geometry%20fields%20in%20QGIS&hashtags=GIS,Geometry,PyQGIS,Python,QGIS,FOSS,&via=CarsonFarmer"
  onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=600');return false;"
  class="label label-primary">
  <i class="fa fa-twitter-square fa-2x"></i> Tweet
</a>
<a href="https://plus.google.com/share?url=http%3A//www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/" 
  onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=600');return false;"
  class="label label-primary">
  <i class="fa fa-google-plus-square fa-2x"></i> Share
</a>

<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A//www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/&title=Adding%20direct%20editing%20of%20geometry%20fields%20in%20QGIS&summary=Being%20able%20to%20add/remove%20attributes%20isn%E2%80%99t%20actually%20a%20very%20new%20feature%20for%20QGIS%20at%20this%20point.%20However%2C%20to%20date%20non%20of%20the%20fTools%20functions%20%28Vector%20menu%29%20have%20taken%20advantage%20of%20this%20capability.%20If%20a%20tool%20needed%20to%20create%20a%20new%20field%20in%20the%20input%20vector%20layer%2C%20it%20simply%20wrote%20a%20new%20version%20of%20the%20vector%20layer%20to%20disk%20with%20the%20additional%20fields%20added.%20There%20have%20been%20several%20requests%20to%20allow%20some%20tools%20to%20add/update%20attributes%20directly%20on%20the%20input%20layers%2C%20so%20I%20went%20ahead%20and%20created%20a%20script%20to%20test%20this%20functionality%20out.%20I%E2%80%99ve%20provided%20a%20copy%20here%20for%20anyone%20who%20would%20like%20to%20test%20it%20out%20before%20I%20add%20it%20to%20QGIS%20permanently.%20Basically%2C%20the%20script%20will%20replace/update%20three%20of%20the%20Vector%20menu%20tools%2C%20including%20Analysis%20%5C%3E%20Sum%20line%20lengths%2C%20Analysis%20%5C%3E%20Points%20in%20polygon%2C%20and%20Geometry%20tools%20%5C%3E%20Add/Export%20geometry%20info.&source=CarsonFarmer"
  onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=600');return false;"
  class="label label-primary">
  <i class="fa fa-linkedin-square fa-2x"></i> Share
</a>

<a href="http://www.tumblr.com/share/link?url=http%3A//www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/&name=Adding%20direct%20editing%20of%20geometry%20fields%20in%20QGIS&description=Being%20able%20to%20add/remove%20attributes%20isn%E2%80%99t%20actually%20a%20very%20new%20feature%20for%20QGIS%20at%20this%20point.%20However%2C%20to%20date%20non%20of%20the%20fTools%20functions%20%28Vector%20menu%29%20have%20taken%20advantage%20of%20this%20capability.%20If%20a%20tool%20needed%20to%20create%20a%20new%20field%20in%20the%20input%20vector%20layer%2C%20it%20simply%20wrote%20a%20new%20version%20of%20the%20vector%20layer%20to%20disk%20with%20the%20additional%20fields%20added.%20There%20have%20been%20several%20requests%20to%20allow%20some%20tools%20to%20add/update%20attributes%20directly%20on%20the%20input%20layers%2C%20so%20I%20went%20ahead%20and%20created%20a%20script%20to%20test%20this%20functionality%20out.%20I%E2%80%99ve%20provided%20a%20copy%20here%20for%20anyone%20who%20would%20like%20to%20test%20it%20out%20before%20I%20add%20it%20to%20QGIS%20permanently.%20Basically%2C%20the%20script%20will%20replace/update%20three%20of%20the%20Vector%20menu%20tools%2C%20including%20Analysis%20%5C%3E%20Sum%20line%20lengths%2C%20Analysis%20%5C%3E%20Points%20in%20polygon%2C%20and%20Geometry%20tools%20%5C%3E%20Add/Export%20geometry%20info."
  onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=600');return false;"
  class="label label-primary">
  <i class="fa fa-tumblr-square fa-2x"></i> Share
</a>

<a href="http://www.facebook.com/sharer.php?s=100&p[url]=http%3A//www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/&p[title]=Adding%20direct%20editing%20of%20geometry%20fields%20in%20QGIS&p[summary]=Being%20able%20to%20add/remove%20attributes%20isn%E2%80%99t%20actually%20a%20very%20new%20feature%20for%20QGIS%20at%20this%20point.%20However%2C%20to%20date%20non%20of%20the%20fTools%20functions%20%28Vector%20menu%29%20have%20taken%20advantage%20of%20this%20capability.%20If%20a%20tool%20needed%20to%20create%20a%20new%20field%20in%20the%20input%20vector%20layer%2C%20it%20simply%20wrote%20a%20new%20version%20of%20the%20vector%20layer%20to%20disk%20with%20the%20additional%20fields%20added.%20There%20have%20been%20several%20requests%20to%20allow%20some%20tools%20to%20add/update%20attributes%20directly%20on%20the%20input%20layers%2C%20so%20I%20went%20ahead%20and%20created%20a%20script%20to%20test%20this%20functionality%20out.%20I%E2%80%99ve%20provided%20a%20copy%20here%20for%20anyone%20who%20would%20like%20to%20test%20it%20out%20before%20I%20add%20it%20to%20QGIS%20permanently.%20Basically%2C%20the%20script%20will%20replace/update%20three%20of%20the%20Vector%20menu%20tools%2C%20including%20Analysis%20%5C%3E%20Sum%20line%20lengths%2C%20Analysis%20%5C%3E%20Points%20in%20polygon%2C%20and%20Geometry%20tools%20%5C%3E%20Add/Export%20geometry%20info."
  onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=600');return false;"
  class="label label-primary">
  <i class="fa fa-facebook-square fa-2x"></i> Share
</a>

</div>    </header>

    <div class="entry-content">
      <p>Being able to add/remove attributes isn&#8217;t actually a very new feature
for <span class="caps">QGIS</span> at this point. However, to date non of the fTools functions
(Vector menu) have taken advantage of this capability. If a tool needed
to create a new field in the input vector layer, it simply wrote a new
version of the vector layer to disk with the additional fields added.
There have been several requests to allow some tools to add/update
attributes directly on the input layers, so I went ahead and created a
script to test this functionality out. I&#8217;ve 
<a href="|filname|/uploads/add_geometry_information.py">provided a copy here</a> 
for anyone who would like to test it out before I add it to <span class="caps">QGIS</span>
permanently. Basically, the script will replace/update three of the
Vector menu tools, including <code>Analysis \&gt; Sum line lengths</code>, <code>Analysis
\&gt; Points in polygon</code>, and <code>Geometry tools \&gt; Add/Export geometry
info</code>.

Here are some examples of the script&#8217;s usage from the <span class="caps">QGIS</span> Python&nbsp;console:</p>
<ol>
<li>Add geometry information (assumes that the target layer in first
layer in the&nbsp;layer-list):</li>
</ol>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">mc</span> <span class="o">=</span> <span class="n">qgis</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">add_geometry_information</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add_geometry_information</span><span class="o">.</span><span class="n">addGeometryInformation</span><span class="p">(</span><span class="n">vlayer</span><span class="p">)</span> <span class="bp">True</span>
</pre></div>


<ol>
<li>Count the number of points or length of lines in each polygon of an
input polygon layer (assumes polygon layer is second, and point or line
layer is the first in&nbsp;layer-list):</li>
</ol>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">polygonLayer</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">input</span> <span class="n">Layer</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add_geometry_information</span><span class="o">.</span><span class="n">countFeaturesInPolygon</span><span class="p">(</span><span class="n">polygonLayer</span><span class="p">,</span> <span class="n">inputLayer</span><span class="p">)</span> <span class="bp">True</span>
</pre></div>


<p>Note that to import the module properly (and easily), make sure it is
somewhere that PyQGIS can find it, such as <code>\~/.qgis/python</code>. If the layer
is in editing mode, then udpates can be undone, otherwise, updates are
written automatically to the provider. The <code>countFeaturesInPolygon()</code>
function automatically recognizes if an input layer is a point or line
layer, and computes the correct information accordingly (outputting a
count for points, and line lengths for lines). For both functions, the
last argument can be a boolean specifying whether to update selected
features only (<code>default=False</code>).</p>
<p>C</p>
    <p class="category">
        <i class="fa fa-certificate fa-fw fa-lg"></i>
        <a class="label label-primary" href="http://www.carsonfarmer.com/category/helpful-tip.html">Helpful tip</a> 
    </p>
    <p class="tag">
        <i class="fa fa-tags fa-fw fa-lg"></i>
        <a class="label label-primary" href="http://www.carsonfarmer.com/tag/gis.html">GIS</a>
        </span>
        <a class="label label-primary" href="http://www.carsonfarmer.com/tag/geometry.html">Geometry</a>
        </span>
        <a class="label label-primary" href="http://www.carsonfarmer.com/tag/pyqgis.html">PyQGIS</a>
        </span>
        <a class="label label-primary" href="http://www.carsonfarmer.com/tag/python.html">Python</a>
        </span>
        <a class="label label-primary" href="http://www.carsonfarmer.com/tag/qgis.html">QGIS</a>
        </span>
        <a class="label label-primary" href="http://www.carsonfarmer.com/tag/foss.html">FOSS</a>
        </span>
    </p>
    </div><!-- /.entry-content -->
      <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_identifier = "2011/03/adding-direct-editing-of-geometry-fields-in-qgis/";
          var disqus_url = "http://www.carsonfarmer.com/2011/03/adding-direct-editing-of-geometry-fields-in-qgis/";
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://carsonfarmer.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>

  </article>
</section>
        <section id="extras" class="body shadow">
<div class="twitter">
    
    <h2><a href="https://twitter.com/intent/user?screen_name=CarsonFarmer"
      onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=600');return false;">
    <i class="fa fa-twitter"></i> twitter
        </a>
        </h2>
    <a class="twitter-timeline" href="https://twitter.com/CarsonFarmer" 
        data-chrome="nofooter noheader noborders transparent" 
        data-widget-id="460846751906144256" 
        data-dnt="true" 
        height="300" lang="EN"
        data-related="CarsonFarmer">
        Tweets by @CarsonFarmer
    </a>
    <script>
        !function(d,s,id){
            var js,fjs=d.getElementsByTagName(s)[0], p=/^http:/.test(d.location)?'http':'https';
            if(!d.getElementById(id)){
                js=d.createElement(s);
                js.id=id;js.src=p+"://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js,fjs);
            }
        }(document,"script","twitter-wjs");
    </script>
</div>
<div class="visitors_map">
    
    <h2><a href="http://www.carsonfarmer.com/maps/visitors/"
      onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,height=600,width=700');return false;">
    <i class="fa fa-map-marker"></i> recent visitors
        </a>
        </h2>
  <a href="http://www.carsonfarmer.com/maps/visitors/"><img src="http://www.carsonfarmer.com/uploads/map-thumb.png"></a>
</div>        </section><!-- /#extras -->

        <footer id="contentinfo" class="body ">
            <address id="about" class="vcard body shadow">
                <ul id="links">
                    <li><i class="fa fa-certificate fa-fw"></i><a href="http://www.carsonfarmer.com/categories.html"> Categories</a></li>
                    <li><i class="fa fa-tags fa-fw"></i><a href="http://www.carsonfarmer.com/tags.html"> Tags</a></li>
                </ul>
                Carson Farmer | Assistant Professor of GIScience | Department Geography</br>
                Hunter College, CUNY | 695 Park Avenue, New York, NY, 10065</br>
            <p class="social-icons attribution">
                  <a href="https://twitter.com/CarsonFarmer" data-toggle="tooltip" title="" data-original-title="twitter" data-placement="bottom">
                    <i class="fa fa-twitter fa-lg"></i>
                  </a>
                  <a href="https://github.com/cfarmer" data-toggle="tooltip" title="" data-original-title="github" data-placement="bottom">
                    <i class="fa fa-github fa-lg"></i>
                  </a>
                  <a href="http://about.me/carson.farmer" data-toggle="tooltip" title="" data-original-title="about.me" data-placement="bottom">
                    <i class="fa fa-user fa-lg"></i>
                  </a>
                  <a href="http://hunter-cuny.academia.edu/CarsonFarmer" data-toggle="tooltip" title="" data-original-title="academia.edu" data-placement="bottom">
                    <i class="fa fa-book fa-lg"></i>
                  </a>
                  <a href="http://www.linkedin.com/pub/carson-farmer/40/3bb/27/" data-toggle="tooltip" title="" data-original-title="linkedin" data-placement="bottom">
                    <i class="fa fa-linkedin fa-lg"></i>
                  </a>
                  <a href="https://plus.google.com/108062014159451325697/about/p/pub" data-toggle="tooltip" title="" data-original-title="google+" data-placement="bottom">
                    <i class="fa fa-google-plus fa-lg"></i>
                  </a>
                  <a href="http://cuny.is/cfarmer" data-toggle="tooltip" title="" data-original-title="cuny.is" data-placement="bottom">
                    <i class="fa fa-comment-o fa-lg"></i>
                  </a>
                  <a href="mailto:carson.farmer@gmail.com" data-toggle="tooltip" title="" data-original-title="email" data-placement="bottom">
                    <i class="fa fa-envelope fa-lg"></i>
                  </a>
                <script >
                $("[data-toggle=tooltip]").tooltip();
                </script>
            </p>
            </address><!-- /#about -->
            <p class="attribution">This blog is proudly 
                powered by <a href="http://getpelican.com/">Pelican</a>, 
                which takes great advantage of 
                <a href="http://python.org">Python</a>.</br>
                Icons are courtesy of 
                <a href="http://fortawesome.github.io/Font-Awesome/">FontAwesome</a> 
                and the styling is mostly done via 
                <a href="http://getbootstrap.com/">Bootstrap</a>.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41110370-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'carsonfarmer';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script src="http://www.carsonfarmer.com/theme/js/tools.js"></script>
<script>
size_background("/theme/images/bg/")
</script>
</body>
</html>