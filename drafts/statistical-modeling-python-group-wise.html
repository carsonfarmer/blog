<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <title>Group-wise Models</title>
        <link rel="stylesheet" href="http://www.carsonfarmer.com/theme/css/main.css">
        <link href="http://www.carsonfarmer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Carson Farmer Atom Feed" />
        <link href="http://www.carsonfarmer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Carson Farmer RSS Feed" />
            
<script src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\(","\)"] ],
                displayMath: [ ['$$','$$'], ["\[","\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
</script>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
        <script src="http://www.carsonfarmer.com/libs/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="http://leaflet.cloudmade.com/dist/leaflet.js"></script>
        <link rel="stylesheet" href="http://leaflet.cloudmade.com/dist/leaflet.css" />
        <!--[if lte IE 8]><link rel="stylesheet" href="http://leaflet.cloudmade.com/dist/leaflet.ie.css" /><![endif]-->
        <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.3"></script>
        <!--<script src="http://twitter.github.io/bootstrap/assets/js/bootstrap-tooltip.js"></script>-->
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <script type="text/javascript">
            var loc = [40.7684, -73.9637, 10];
            function initialize() {
                var layer = "watercolor";
                var map = new L.Map("map", {
                        center: new L.LatLng(loc[0], loc[1]),
                        zoom: loc[2],
                        zoomControl: false
                    });
                map.addLayer(new L.StamenTileLayer(layer, {opacity: 0.6}));
                map.locate({setView: true, watch: true})
                  .on('locationfound', function(e) {
                    var marker = L.marker([e.latitude, e.longitude]).bindPopup('Thanks for stopping by!');
                    map.addLayer(marker);
                  });
            }
        </script>
</head> 

<body id="index" class="home" onload="initialize()">
<div id="map" style="position: fixed;"></div>
        <header id="banner" class="body">
                <h1><a href="http://www.carsonfarmer.com/">Carson Farmer  <strong>www.carsonfarmer.com</strong></a></h1>
                <form class="form-inline" id="top-search">
    <div class='input-append'>
        <input type="text" id="top-query" placeholder="Search..." />
        <button class="btn add-on" id="top-btn" type="button">
            <i class="icon-search"></i>
        </button>
<div class="dropdown pull-right" id="top-dropdown">
<a class="dropdown-toggle" id="top-toggle" role="button" data-toggle="dropdown" data-target="#" href="."></a>
<ul class="dropdown-menu pull-right" role="menu" id="top-results" aria-labelledby="top-toggle"></ul></div>
    </div>
</form>
                <div class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
<li><a id="home" href="http://www.carsonfarmer.com/"><i class="icon-home"></i></a></li>
                                <li class="divider-vertical"></li>
                                    <li><a href="http://www.carsonfarmer.com/about/"><i class="icon-info-sign"></i> About</a></li>
                                    <li><a href="http://www.carsonfarmer.com/curriculum-vitae/"><i class="icon-rocket"></i> Curriculum Vitae</a></li>
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" id="Work-drop" role="button" href="#">
                                        <i class="icon-globe"></i> Work<i class="icon-chevron-down"></i></a>
                                        <ul class="dropdown-menu" role="menu" id="Work-menu" aria-labelledby="Work-drop">
                                                <li><a href="http://www.carsonfarmer.com/research/"><i class="icon-bar-chart"></i> Research</a></li>
                                                <li><a href="http://www.carsonfarmer.com/spatial-software/"><i class="icon-code"></i> Software</a></li>
                                        </ul>
                                    </li>
                                <li class="dropdown pull-right">
                                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" id="social-drop" href="#">
                                    <i class="icon-group"></i> Social<i class="icon-chevron-down"></i></a>
                                    <ul class="dropdown-menu pull-right" role="menu" id="social-menu" aria-labelledby="social-drop">
                                        <li>
                                          <a href="http://www.carsonfarmer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">
                                          <i class="icon-rss"></i> atom feed</a>
                                        </li>
                                        <li>
                                          <a href="http://www.carsonfarmer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">
                                          <i class="icon-rss"></i> rss feed</a>
                                        </li>
                                            <li><a href="https://twitter.com/CarsonFarmer"><i class="icon-twitter"></i> twitter</a></li>
                                            <li><a href="https://github.com/cfarmer"><i class="icon-github"></i> github</a></li>
                                            <li><a href="http://about.me/carson.farmer"><i class="icon-user"></i> about.me</a></li>
                                            <li><a href="http://hunter-cuny.academia.edu/CarsonFarmer"><i class="icon-book"></i> academia.edu</a></li>
                                            <li><a href="http://www.linkedin.com/pub/carson-farmer/40/3bb/27/"><i class="icon-linkedin"></i> linkedin</a></li>
                                            <li><a href="https://plus.google.com/108062014159451325697/about/p/pub"><i class="icon-google-plus"></i> google+</a></li>
                                            <li><a href="http://cuny.is/cfarmer"><i class="icon-comment-alt"></i> cuny.is</a></li>
                                            <li><a href="mailto:carson.farmer@gmail.com"><i class="icon-envelope"></i> email</a></li>
                                    </ul>
                                </li>
                        </ul>
                    </div>
                </div>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article class="hentry shadow">
    <header>
      <h1 class="entry-title">
        <a href="http://www.carsonfarmer.com/2013/12/statistical-modeling-python-group-wise/" rel="bookmark"
           title="Permalink to Group-wise Models">Group-wise&nbsp;Models</a></h1>
      <abbr class="published" title="2013-12-20T11:34:00">
          <i class="icon-calendar"></i>
          Fri 20 December 2013
      </abbr>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="CarsonFarmer">Tweet</a>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
<div class="g-plusone" data-size="medium"></div>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">
 lang: en_US
</script>
<script type="IN/Share" data-counter="right"></script>    </header>

    <div class="entry-content">
      <p>This tutorial marks the 4th release from a <a href="http://www.carsonfarmer.com/category/statistical-modeling-for-python.html">series of tutorials</a> on using Python for introductory statistical analysis. This time around, I cover the difference between &#8220;grand&#8221; and &#8220;group-wise&#8221; statistics, and (towards the end of the tutorial), we&#8217;ll even look at some very simple models of grouped data. As always, the notebook for this tutorial is <a href="https://github.com/cfarmer/stat-mod-fresh-approach-python">available here</a>.</p>
<p>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Calculating means and other simple statistics is a matter of using the right function in Python. The &#8216;pandas&#8217; package - which you should <code>import</code> in to Python as shown in previous tutorials - makes it straightforward to calculate either a &quot;grand&quot; statistic or a &quot;group-wise&quot; statistic. To&nbsp;illustrate:</p>
<p>Load the pandas and numpy libraries, needed only once per&nbsp;session:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[1]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
</pre></div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Read in data you are interested in analyzing, for instance the Cherry-Blossom 2008 data described in the textbook, which gives the running times of all 12,302 participants in a ten-mile long running race held in Washington, <span class="caps">DC</span> in March&nbsp;2008:</p>
<p><span class="dataset shadow"><i class="icon-flag" style="font-size: 1.5em;"></i> <a href="http://www.mosaic-web.org/go/datasets/Cherry-Blossom-2008.csv"><code>Cherry-Blossom-2008.csv</code></a></span></p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[2]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">run</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&quot;http://www.mosaic-web.org/go/datasets/Cherry-Blossom-2008.csv&quot;</span><span class="p">)</span>
<span class="n">run</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[2]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
Index([u&apos;position&apos;, u&apos;division&apos;, u&apos;total&apos;, u&apos;name&apos;, u&apos;age&apos;, u&apos;place&apos;, u&apos;net&apos;, u&apos;gun&apos;, u&apos;sex&apos;], dtype=&apos;object&apos;)
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Calculate a grand mean on the <code>gun</code> time - the time from the start of the race, signalled by a gun, and when each runner crossed the ﬁnish&nbsp;line:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[3]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">run</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[3]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
93.72503928900467
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Other &#8216;grand&#8217; statistics&nbsp;include:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[4]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">run</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[4]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
93.683333333333294
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[5]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">run</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[5]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
14.968986824852266
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>To tell Python that you want to break the statistics down by groups, use the <code>groupby()</code> function. You will be using this function frequently in looking at group-wise&nbsp;statistics.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[6]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">run</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;sex&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[6]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
sex
F      98.772771
M      88.256734
Name: gun, dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Other statistics work the same way, for&nbsp;instance:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[7]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">run</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;sex&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[7]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
sex
F      13.337132
M      14.718514
Name: gun, dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Another example &#8230; <code>wage</code> broken down by <code>sector</code> of the economy, using the &#8216;Current Population Survey&#8217; wage data used in the&nbsp;textbook:</p>
<p><span class="dataset shadow"><i class="icon-flag" style="font-size: 1.5em;"></i> <a href="http://www.mosaic-web.org/go/datasets/cps.csv"><code>cps.csv</code></a></span></p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[8]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">cps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&quot;http://www.mosaic-web.org/go/datasets/cps.csv&quot;</span><span class="p">)</span>
<span class="n">cps</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">wage</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[8]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
sector
clerical     7.422577
const        9.502000
manag       12.704000
manuf        8.036029
other        8.500588
prof        11.947429
sales        7.592632
service      6.537470
Name: wage, dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p><span class="note left shadow"> A study done in the early 1970s in Whickham, <span class="caps">UK</span>, examined the health consequences of smoking. The method of the study was simple: interview women to ﬁnd out who smokes and who doesn’t. Then, 20 years later, follow-up to ﬁnd out who is still&nbsp;living. </span></p>
<p><span class="dataset shadow"><i class="icon-flag" style="font-size: 1.5em;"></i> <a href="http://www.mosaic-web.org/go/datasets/whickham.csv"><code>whickham.csv</code></a></span></p>
</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the Whickham smoking data example from the textbook, the outcome for each person was not a number but a category: Alive or Dead at the time of the&nbsp;follow-up.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[9]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&quot;http://www.mosaic-web.org/go/datasets/whickham.csv&quot;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[9]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
Index([u&apos;outcome&apos;, u&apos;smoker&apos;, u&apos;age&apos;], dtype=&apos;object&apos;)
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[10]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">w</span><span class="o">.</span><span class="n">outcome</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[10]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
array([&apos;Alive&apos;, &apos;Dead&apos;], dtype=object)
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>To find the proportion of people who were alive at the end of the 20-year followup period, you can use a computational trick. Convert the outcome variable to <code>True</code> or <code>False</code> to indicate whether an individual is alive, then take the mean of the True/False values. Python, like many computer languages, treats <code>True</code> as 1 and <code>False</code> as 0 for the purposes of doing&nbsp;arithmetic.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[11]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">w</span><span class="p">[</span><span class="s">&quot;alive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">outcome</span><span class="o">==</span><span class="s">&quot;Alive&quot;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[11]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
0.71917808219178081
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>This can also be done using the following &#8216;short hand&#8217;&nbsp;version:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[12]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">outcome</span><span class="o">==</span><span class="s">&quot;Alive&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[12]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
0.71917808219178081
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here&#8217;s the breakdown according to smoking&nbsp;status:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[13]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">w</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;smoker&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[13]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
smoker
No        0.685792
Yes       0.761168
Name: alive, dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>A more meaningful question is whether smokers are diﬀerent from non-smokers when holding other variables constant, such as age. To address this question, you need to add age into the&nbsp;mix.</p>
<p>It might be natural to consider each age (35, 36, 37, and so on) as a separate group, but you won’t get very many members of each group. And, likely, the data for 35 year-olds has quite a lot to say about 36 year-olds, so it doesn’t make sense to treat them as completely separate&nbsp;groups.</p>
<p>You can use the <code>cut()</code> function to divide up a quantitative variable into groups. You get to specify the breaks between groups. Using functionality we have already seen (e.g., when we created the new variable <code>alive</code> above), you can <em>add</em> the new variable to an existing data&nbsp;frame:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[14]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">w</span><span class="p">[</span><span class="s">&quot;agegroups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">w</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;agegroups&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[14]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
agegroups
(0, 30]      0.979167
(30, 40]     0.948413
(40, 53]     0.832143
(53, 64]     0.625498
(64, 75]     0.201183
(75, 100]    0.000000
Name: alive, dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[15]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">w</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="s">&quot;agegroups&quot;</span><span class="p">,</span> <span class="s">&quot;smoker&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[15]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
agegroups  smoker
(0, 30]    No        0.981818
           Yes       0.975610
(30, 40]   No        0.955224
           Yes       0.940678
(40, 53]   No        0.876106
           Yes       0.802395
(53, 64]   No        0.669291
           Yes       0.580645
(64, 75]   No        0.213740
           Yes       0.157895
(75, 100]  No        0.000000
           Yes       0.000000
Name: alive, dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>The mean has been calculated group-by-group. This is a very widely used technique, but there is a better approach that will be introduced in later chapters: use quantitative variables directly without dividing them into&nbsp;groups.</p>
</div>
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="model-values-and-residuals">Model Values and&nbsp;Residuals</h2>
<p>A group-wise model tells you the model value for each group. There is additional information that you will want to generate about models. Two fundamental aspects of a model are the &#8216;fitted&#8217; model values for each case and the &#8216;residual&#8217; for each case. To make it easy to do these calculations, Python has a set of modeling functions from the &#8216;statsmodels&#8217; library that helps keep track of the data used in creating and fitting models. Later tutorials will introduce the <code>ols()</code> function more thouroughly - ordinary least squares - that is central to statistical&nbsp;modeling.</p>
<p>For now, we will use <code>ols()</code> to create a simple model based on groupwise means, and worry about all the additional diagnostics and summary statistics&nbsp;later.</p>
</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p><span class="note left shadow"> From a very young age, shoes for boys tend to be wider than shoes for girls. Is this because boys have wider feet, or because it is assumed that girls are willing to sacrifice comfort for fashion, even in elementary school? To assess the former, Mary C. Meyer, a statistician from Arbor, <span class="caps">MI</span> <a href="http://www.amstat.org/publications/jse/v14n1/datasets.meyer.html">measured kids&#8217; feet</a> in a fourth grade classroom back in October 1997. Her ultimate goal was to answer the question: &quot;do boys have wider feet than girls?&quot;. We are going to work with this data throughout these tutorials to build simple models and test for various statistical&nbsp;relationships. </span></p>
<p><span class="dataset shadow"><i class="icon-flag" style="font-size: 1.5em;"></i> <a href="http://www.mosaic-web.org/go/datasets/kidsfeet.csv"><code>kidsfeet.csv</code></a></span></p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[16]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">as</span> <span class="nn">sm</span> <span class="c"># import statsmodels</span>
<span class="n">kids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&quot;http://www.mosaic-web.org/go/datasets/kidsfeet.csv&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[17]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">mod</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s">&#39;width ~ sex -1&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">kids</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">mod</span><span class="o">.</span><span class="n">params</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[17]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
sex[B]    9.190000
sex[G]    8.784211
dtype: float64
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note the use of the <code>~</code> (pronounced &quot;tilde&quot;) notation above. You will be using this notation frequently in building models. It means, &quot;model by&quot;, &quot;broken down by&quot;, &quot;versus&quot;, or &quot;as a function&nbsp;of&quot;.</p>
</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>fittedvalues</code> attribute of a model, such as generated by <code>ols().fit()</code>, returns the fitted model value for each case in the data used to fit the model. To do this, the model takes each case in turn, figures out which group it belongs to and the corresponding model value, and then returns the set of model value for each of the cases. For&nbsp;example:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[18]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">mod</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">.</span><span class="n">values</span> <span class="c"># use `values` attribute to return simple array of fitted model values</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[18]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
array([ 9.19      ,  9.19      ,  9.19      ,  9.19      ,  9.19      ,
        9.19      ,  9.19      ,  8.78421053,  8.78421053,  9.19      ,
        9.19      ,  9.19      ,  9.19      ,  9.19      ,  8.78421053,
        8.78421053,  8.78421053,  8.78421053,  8.78421053,  8.78421053,
        9.19      ,  9.19      ,  8.78421053,  8.78421053,  8.78421053,
        9.19      ,  8.78421053,  9.19      ,  9.19      ,  9.19      ,
        8.78421053,  8.78421053,  8.78421053,  9.19      ,  9.19      ,
        8.78421053,  8.78421053,  8.78421053,  8.78421053])
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>The residuals are found by subtracting the case-by-case model value from the actual values for each case. This is accomplished by the <code>resid</code> attribute of the <code>mod</code> model, which works in much the same way as <code>fitted</code>:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[19]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">mod</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">values</span> <span class="c"># again, use `values` to return simple array of residuals</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[19]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
array([-0.79      , -0.39      ,  0.51      ,  0.61      , -0.29      ,
        0.51      ,  0.41      ,  0.01578947,  0.51578947, -0.39      ,
        0.61      , -0.29      , -0.09      ,  0.61      ,  0.51578947,
       -0.88421053, -0.08421053,  0.01578947,  0.21578947,  0.71578947,
        0.01      , -0.59      , -0.48421053,  0.21578947, -0.68421053,
        0.21      ,  0.71578947,  0.31      , -0.29      ,  0.11      ,
        0.51578947, -0.18421053, -0.18421053, -0.19      , -0.59      ,
       -0.28421053,  0.21578947, -0.88421053,  0.01578947])
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>For each case, adding the residual to the fitted value will produce the value of the response&nbsp;variable.</p>
<p>The <code>var()</code> function calculates variance. There is a simple additive relationship among the variances of the response variable, the model&#8217;s fitted values, and the corresponding residual&nbsp;values:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[20]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">kids</span><span class="o">.</span><span class="n">width</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[20]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
0.25967611336032387
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[21]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">mod</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[21]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
0.042221819731514662
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[22]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">mod</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[22]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
0.21745429362880889
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>The variance of the response variable is equal to the variance of the fitted values <em>and</em> the variance of the residuals. Below, we show this (response var equal to fitted var plus residual var), with rounding to 8 significant digits to avoid numerical roundoff&nbsp;errors:</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<div class="prompt input_prompt">
In&nbsp;[23]:
</div>
<div class="input_area box-flex1">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">kids</span><span class="o">.</span><span class="n">width</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">+</span> <span class="n">mod</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">())</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><div class="prompt output_prompt">
    Out[23]:</div>
<div class="box-flex1 output_subarea output_pyout">


<pre>
True
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="reference">Reference</h3>
<p>As with all &#8216;Statistical Modeling: A Fresh Approach for Python&#8217; tutorials, this tutorial is based directly on material from <a href="http://www.mosaic-web.org/go/StatisticalModeling/">&#8216;Statistical Modeling: A Fresh Approach (2nd Edition)&#8217;</a> by <a href="http://www.macalester.edu/~kaplan/">Daniel Kaplan</a>. This tutorial is based on Chapter 4: Group-wise&nbsp;Models.</p>
<p>I have made an effort to keep the text and explanations consistent between the original (R-based) version and the Python tutorials, in order to keep things comparable. With that in mind, any errors, omissions, and/or differences between the two versions are mine, and any questions, comments, and/or concerns should be <script type="text/javascript">
<!--
h='&#104;&#x75;&#110;&#116;&#x65;&#114;&#46;&#x63;&#x75;&#110;&#x79;&#46;&#x65;&#100;&#x75;';a='&#64;';n='&#x63;&#x61;&#114;&#x73;&#x6f;&#110;&#46;&#102;&#x61;&#114;&#x6d;&#x65;&#114;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'">'+'directed to me'+'<\/'+'a'+'>');
// -->
</script><noscript>&#100;&#x69;&#114;&#x65;&#x63;&#116;&#x65;&#100;&#32;&#116;&#x6f;&#32;&#x6d;&#x65;&#32;&#40;&#x63;&#x61;&#114;&#x73;&#x6f;&#110;&#46;&#102;&#x61;&#114;&#x6d;&#x65;&#114;&#32;&#x61;&#116;&#32;&#104;&#x75;&#110;&#116;&#x65;&#114;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x75;&#110;&#x79;&#32;&#100;&#x6f;&#116;&#32;&#x65;&#100;&#x75;&#x29;</noscript>.</p>
</div></p>
    <p class="category">
        <i class="icon-certificate"></i>
        <a href="http://www.carsonfarmer.com/category/statistical-modeling-for-python.html">Statistical Modeling for Python</a> 
    </p>
    <p class="tag">
        <i class="icon-tags"></i>
 <a href="http://www.carsonfarmer.com/tag/helpful-tips.html">Helpful tips</a>
 <a href="http://www.carsonfarmer.com/tag/python.html">Python</a>
 <a href="http://www.carsonfarmer.com/tag/statistical-modeling.html">Statistical Modeling</a>
 <a href="http://www.carsonfarmer.com/tag/teaching.html">Teaching</a>
    </p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body shadow">
<div class="twitter">
        <h2><i class="icon-twitter"></i> twitter</h2>
        <a class="twitter-timeline" href="https://twitter.com/CarsonFarmer" 
            data-link-color="#2A75A9" 
            data-chrome="nofooter noheader noborders transparent" 
            data-widget-id="330339195518337025"
            height="300" lang="EN"
            data-related="CarsonFarmer">
            Tweets by @CarsonFarmer
        </a>
        <script>
            !function(d,s,id){
                var js,fjs=d.getElementsByTagName(s)[0], p=/^http:/.test(d.location)?'http':'https';
                if(!d.getElementById(id)){
                    js=d.createElement(s);
                    js.id=id;js.src=p+"://platform.twitter.com/widgets.js";
                    fjs.parentNode.insertBefore(js,fjs);
                }
            }(document,"script","twitter-wjs");
        </script>

</div>
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body ">
                <address id="about" class="vcard body shadow">
                                <ul id="links">
                                    <li><a href="http://www.geo.hunter.cuny.edu/cfarmer/">CUNY Faculty Page</a></li>
                                    <li><a href="http://www.carsilab.org/">CARSI Lab</a></li>
                                </ul>
                Carson Farmer| Assistant Professor of GIScience | Department Geography</br>
                Hunter College - CUNY | 695 Park Avenue, New York | New York, 10065</br>
                </address><!-- /#about -->
                <p style="text-align: center;">This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, 
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41110370-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'carsonfarmer';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
    $(function() {
        var search = window.location.search.substring(1)
        if (search == "feed=rss2") window.location = "http://www.carsonfarmer.com/feeds/all.rss.xml"
    });

    $(document).ready(function() {
    
        //Calculate the height of <header>
        //Use outerHeight() instead of height() if have padding
        var aboveHeight = $('.navbar').position().top;

    //when scroll
        $(window).scroll(function() {
            //if scrolled down more than the header’s height
                if ($(window).scrollTop() > aboveHeight){
                // if yes, add "fixed" class to the <nav>
                // add padding top to the #content 
                    // if (!$('nav').hasClass('fixed')) {
                    //     $('.home_link').show("slide", { direction: "right" }, 250)
                    // };
                    $('.navbar').addClass('fixed').addClass('shadow').css('top','0').next() //.addClass('navbar-fixed-top').next()//
                    $('#content').css('margin-top',aboveHeight+20+'px'); // value is same as the height of the nav
                } else {
                // when scroll up or less than aboveHeight,
                // remove the “fixed” class, and the padding-top
                    // if ($('nav').hasClass('fixed')) {
                    //     console.log('test')
                    //     $('.home_link').hide("slide", { direction: "right" }, 250)
                    // };
                    $('.navbar').removeClass('fixed').removeClass('shadow').next()
                    $('#content').css('margin-top','0px');
                }
        });
        $("#top-query").keydown(function(event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                site_search();
                return false;
            }
        });
        $("#top-btn").click(function(event) {
            event.preventDefault();
            site_search();
            return false;
        });
    });
    
function site_search() {
    var query = $("#top-query").val();
    if (query == "") return false;
    var api = 'http://tapirgo.com/api/1/search.json?';
    var token = '51980cd33f61b05bbb000ce0';
    var el = $("#top-results");
    el.empty();
    el.append('<li style="padding-left: 10px">Fetching results...</li>')
    $.getJSON(api + 'token=' + token + '&query=' + query + '&callback=?', 
        function(data) {
            // insert function here if needed
            if (data.length) {
                el.empty();
                $.each(data, function(key, val) {
                    var xx = new Date(val.published_on)+""
                    if ((/^http\:\/\/www.carsonfarmer.com/).test(val.link)) { // hack to ignore duplicate returns
                        el.append('<li><a href="' + val.link + '" data-toggle="tooltip" data-placement="right" ' + 
                            'title="'+ xx.substring(0,15) + '">' + val.title + '</a>' + '</li>');
                    }
                });
            } else {
                el.empty();
                el.append('<li style="padding-left: 10px">No results found...</li>')
            };
        $("[data-toggle=tooltip]").tooltip();
    });
    $("#top-toggle").dropdown('toggle');
}
</script>
</body>
</html>