<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <title>Syntax highlighting with PyQt</title>
        <link rel="stylesheet" href="http://www.carsonfarmer.com/theme/css/main.css">
        <link href="http://www.carsonfarmer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Carson Farmer Atom Feed" />
        <link href="http://www.carsonfarmer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Carson Farmer RSS Feed" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
        <script src="http://www.carsonfarmer.com/libs/bootstrap/js/bootstrap.min.js"></script>
        <!--<script src="http://twitter.github.io/bootstrap/assets/js/bootstrap-tooltip.js"></script>-->
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head> 

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://www.carsonfarmer.com/">Carson Farmer  <strong>www.carsonfarmer.com</strong></a></h1>
                <form class="form-inline" id="top-search">
    <div class='input-append'>
        <input type="text" id="top-query" placeholder="Search..." />
        <button class="btn add-on" id="top-btn" type="button">
            <i class="icon-search"></i>
        </button>
<div class="dropdown pull-right" id="top-dropdown">
<a class="dropdown-toggle" id="top-toggle" role="button" data-toggle="dropdown" data-target="#" href="."></a>
<ul class="dropdown-menu pull-right" role="menu" id="top-results" aria-labelledby="top-toggle"></ul></div>
    </div>
</form>
                <div class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
<li><a id="home" href="http://www.carsonfarmer.com/"><i class="icon-home"></i></a></li>
                                <li class="divider-vertical"></li>
                                    <li><a href="http://www.carsonfarmer.com/about/"><i class="icon-info-sign"></i> About</a></li>
                                    <li><a href="http://www.carsonfarmer.com/curriculum-vitae/"><i class="icon-rocket"></i> Curriculum Vitae</a></li>
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" id="Work-drop" role="button" href="#">
                                        <i class="icon-globe"></i> Work<i class="icon-chevron-down"></i></a>
                                        <ul class="dropdown-menu" role="menu" id="Work-menu" aria-labelledby="Work-drop">
                                                <li><a href="http://www.carsonfarmer.com/research/"><i class="icon-bar-chart"></i> Reserach</a></li>
                                                <li><a href="http://www.carsonfarmer.com/spatial-software/"><i class="icon-code"></i> Software</a></li>
                                        </ul>
                                    </li>
                                <li class="dropdown pull-right">
                                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" id="social-drop" href="#">
                                    <i class="icon-group"></i> Social<i class="icon-chevron-down"></i></a>
                                    <ul class="dropdown-menu pull-right" role="menu" id="social-menu" aria-labelledby="social-drop">
                                        <li>
                                          <a href="http://www.carsonfarmer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">
                                          <i class="icon-rss"></i> atom feed</a>
                                        </li>
                                        <li>
                                          <a href="http://www.carsonfarmer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">
                                          <i class="icon-rss"></i> rss feed</a>
                                        </li>
                                            <li><a href="https://twitter.com/CarsonFarmer"><i class="icon-twitter"></i> twitter</a></li>
                                            <li><a href="https://github.com/cfarmer"><i class="icon-github"></i> github</a></li>
                                            <li><a href="http://about.me/carson.farmer"><i class="icon-user"></i> about.me</a></li>
                                            <li><a href="http://hunter-cuny.academia.edu/CarsonFarmer"><i class="icon-book"></i> academia.edu</a></li>
                                            <li><a href="http://www.linkedin.com/pub/carson-farmer/40/3bb/27/"><i class="icon-linkedin"></i> linkedin</a></li>
                                            <li><a href="https://plus.google.com/108062014159451325697/about/p/pub"><i class="icon-google-plus"></i> google+</a></li>
                                            <li><a href="mailto:carson.farmer@gmail.com"><i class="icon-envelope"></i> email</a></li>
                                    </ul>
                                </li>
                        </ul>
                    </div>
                </div>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article class="hentry shadow">
    <header>
      <h1 class="entry-title">
        <a href="http://www.carsonfarmer.com/2009/07/syntax-highlighting-with-pyqt/" rel="bookmark"
           title="Permalink to Syntax highlighting with PyQt">Syntax highlighting with&nbsp;PyQt</a></h1>
      <abbr class="published" title="2009-07-02T15:28:00">
          <i class="icon-calendar"></i>
          Thu 02 July 2009
      </abbr>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="CarsonFarmer">Tweet</a>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
<div class="g-plusone" data-size="medium"></div>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">
 lang: en_US
</script>
<script type="IN/Share" data-counter="right"></script>    </header>

    <div class="entry-content">
      <p>A few months ago I decided to add syntax highlighting capabilities to a
<a href="http://www.ftools.ca/plugins.html">piece of software</a> that I have been working on. Since it is a PyQt
based application, the obvious choice for implementing syntax
highlighting was to use Qt&#8217;s QSyntaxHighlighter. Unfortunately, there
weren&#8217;t many examples around that implemented syntax highlighting in
Python, so I decided to post my own.
</p>
<p>The Python file used in this example is <a href="http://www.carsonfarmer.com/uploads/highlighter.py">available here</a>.
To implement syntax highlighting, we need to subclass
QSyntaxHighlighter, reimplement the <code>highlightBlock</code> function, and
specify several highlighting rules. Generally, a rule consists of a
QRegExp pattern and a QTextCharFormat instance. For this example, the
syntax rules are based on the R statistical programming language. The
various rules can be stored using a Python&nbsp;list.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">class</span> <span class="nc">MyHighlighter</span><span class="p">(</span> <span class="n">QSyntaxHighlighter</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">theme</span> <span class="p">):</span>
        <span class="n">QSyntaxHighlighter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlightingRules</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">keyword</span> <span class="o">=</span> <span class="n">QTextCharFormat</span><span class="p">()</span>
        <span class="n">keyword</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">darkBlue</span> <span class="p">)</span>
        <span class="n">keyword</span><span class="o">.</span><span class="n">setFontWeight</span><span class="p">(</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span> <span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">QStringList</span><span class="p">(</span> <span class="p">[</span> <span class="s">&quot;break&quot;</span><span class="p">,</span> <span class="s">&quot;else&quot;</span><span class="p">,</span> <span class="s">&quot;for&quot;</span><span class="p">,</span> <span class="s">&quot;if&quot;</span><span class="p">,</span> <span class="s">&quot;in&quot;</span><span class="p">,</span>
                                  <span class="s">&quot;next&quot;</span><span class="p">,</span> <span class="s">&quot;repeat&quot;</span><span class="p">,</span> <span class="s">&quot;return&quot;</span><span class="p">,</span> <span class="s">&quot;switch&quot;</span><span class="p">,</span>
                                  <span class="s">&quot;try&quot;</span><span class="p">,</span> <span class="s">&quot;while&quot;</span> <span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegExp</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">b&quot;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">b&quot;</span><span class="p">)</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="n">HighlightingRule</span><span class="p">(</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">keyword</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rule</span> <span class="p">)</span>
</pre></div>


<p><code>MyHighlighter</code> is the subclassed <code>QSyntaxHighlighter</code> class, and will
contain our reimplemented <code>highlightBlock</code> function. The above example
is for the <code>keyword</code> rule, which recognizes the most common R keywords.
We give <code>keyword</code> a bold, dark blue font. For each keyword, we assign
the keyword and the specified format to a <code>HighlightingRule</code> object (see
the attached Python file) and append the object to our list of rules.
We can specify further syntax rules, including <code>reservedClasses</code>,
<code>assignmentOperators</code>, and <code>numbers</code>:</p>
<div class="highlight"><pre><span class="n">reservedClasses</span> <span class="o">=</span> <span class="n">QTextCharFormat</span><span class="p">()</span>
<span class="n">reservedClasses</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">darkRed</span> <span class="p">)</span>
<span class="n">reservedClasses</span><span class="o">.</span><span class="n">setFontWeight</span><span class="p">(</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span> <span class="p">)</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="n">QStringList</span><span class="p">(</span> <span class="p">[</span> <span class="s">&quot;array&quot;</span><span class="p">,</span> <span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="s">&quot;complex&quot;</span><span class="p">,</span>
                          <span class="s">&quot;data.frame&quot;</span><span class="p">,</span> <span class="s">&quot;double&quot;</span><span class="p">,</span> <span class="s">&quot;factor&quot;</span><span class="p">,</span>
                          <span class="s">&quot;function&quot;</span><span class="p">,</span> <span class="s">&quot;integer&quot;</span><span class="p">,</span> <span class="s">&quot;list&quot;</span><span class="p">,</span>
                          <span class="s">&quot;logical&quot;</span><span class="p">,</span> <span class="s">&quot;matrix&quot;</span><span class="p">,</span> <span class="s">&quot;numeric&quot;</span><span class="p">,</span>
                          <span class="s">&quot;vector&quot;</span> <span class="p">]</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegExp</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">b&quot;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">b&quot;</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">HighlightingRule</span><span class="p">(</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">reservedClasses</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rule</span> <span class="p">)</span>
<span class="n">assignmentOperator</span> <span class="o">=</span> <span class="n">QTextCharFormat</span><span class="p">()</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegExp</span><span class="p">(</span> <span class="s">&quot;(&lt;){1,2}-&quot;</span> <span class="p">)</span>
<span class="n">assignmentOperator</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">green</span> <span class="p">)</span>
<span class="n">assignmentOperator</span><span class="o">.</span><span class="n">setFontWeight</span><span class="p">(</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Bold</span> <span class="p">)</span>
<span class="n">rule</span> <span class="o">=</span> <span class="n">HighlightingRule</span><span class="p">(</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">assignmentOperator</span> <span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rule</span> <span class="p">)</span>
<span class="n">number</span> <span class="o">=</span> <span class="n">QTextCharFormat</span><span class="p">()</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">QRegExp</span><span class="p">(</span> <span class="s">&quot;[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?&quot;</span> <span class="p">)</span>
<span class="n">pattern</span><span class="o">.</span><span class="n">setMinimal</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>
<span class="n">number</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">blue</span> <span class="p">)</span>
<span class="n">rule</span> <span class="o">=</span> <span class="n">HighlightingRule</span><span class="p">(</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">number</span> <span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">highlightingRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rule</span> <span class="p">)</span>
</pre></div>


<p>After a QSyntaxHighlighter object is created, its highlightBlock()
function will be called automatically whenever it is necessary by the
rich text engine, highlighting the given text block. To perform the
actual formatting, the QSyntaxHighlighter class provides the <code>setFormat</code>
function. This function operates on the text block that is passed as
argument to the <code>highlightBlock</code> function. The specified format is
applied to the text from the given start position for the given length.
The formatting properties set in the given format are merged at display
time with the formatting information stored directly in the&nbsp;document.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">highlightBlock</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlightingRules</span><span class="p">:</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="n">QRegExp</span><span class="p">(</span> <span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">indexIn</span><span class="p">(</span> <span class="n">text</span> <span class="p">)</span>
        <span class="k">while</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">matchedLength</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFormat</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">format</span> <span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span> <span class="n">expression</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="n">length</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentBlockState</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
</pre></div>


<p>This process is repeated until the last occurrence of the pattern in the
current text block is found. For rules that apply over multiple blocks
or lines, further logic is needed. For an example, see the
<a href="http://doc.trolltech.com/4.2/richtext-syntaxhighlighter.html">QSynatxHighlighter</a> documentation.
In order to apply the syntax highlighter to a QTextEdit, we simply
create an instance of our QSyntaxHighlighter subclass, and pass it the
QTextEdit or QTextDocument that we want the syntax highlighting to be
applied to, as the following test application&nbsp;demonstrates:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TestApp</span><span class="p">(</span> <span class="n">QMainWindow</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMainWindow</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="n">QTextEdit</span><span class="p">()</span>
        <span class="n">highlighter</span> <span class="o">=</span> <span class="n">MyHighlighter</span><span class="p">(</span> <span class="n">editor</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span> <span class="n">editor</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span> <span class="s">&quot;Syntax Highlighter Example&quot;</span> <span class="p">)</span>
</pre></div>


<p>Once implemented, the above example produces output like&nbsp;this:</p>
<p><a href="http://www.carsonfarmer.com/images/screenshot.png" title="screenshot"><img alt="image" src="http://www.carsonfarmer.com/images/screenshot.png" title="screenshot" /></a></p>
    <p class="category">
        <i class="icon-certificate"></i>
        <a href="http://www.carsonfarmer.com/category/helpful-tips.html">Helpful tips</a> 
    </p>
    <p class="tag">
        <i class="icon-tags"></i>
 <a href="http://www.carsonfarmer.com/tag/pyqt.html">PyQT</a>
 <a href="http://www.carsonfarmer.com/tag/python.html">Python</a>
 <a href="http://www.carsonfarmer.com/tag/syntax-highlighting.html">Syntax highlighting</a>
 <a href="http://www.carsonfarmer.com/tag/free-open-source-software-foss.html">Free open-source software (FOSS)</a>
    </p>
    </div><!-- /.entry-content -->
      <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_identifier = "2009/07/syntax-highlighting-with-pyqt/";
          var disqus_url = "http://www.carsonfarmer.com/2009/07/syntax-highlighting-with-pyqt/";
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://carsonfarmer.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>

  </article>
</section>
        <section id="extras" class="body shadow">
<div class="twitter">
        <h2><i class="icon-twitter"></i> twitter</h2>
        <a class="twitter-timeline" href="https://twitter.com/CarsonFarmer" 
            data-link-color="#2A75A9" 
            data-chrome="nofooter noheader noborders transparent" 
            data-widget-id="330339195518337025"
            height="300" lang="EN"
            data-related="CarsonFarmer">
            Tweets by @CarsonFarmer
        </a>
        <script>
            !function(d,s,id){
                var js,fjs=d.getElementsByTagName(s)[0], p=/^http:/.test(d.location)?'http':'https';
                if(!d.getElementById(id)){
                    js=d.createElement(s);
                    js.id=id;js.src=p+"://platform.twitter.com/widgets.js";
                    fjs.parentNode.insertBefore(js,fjs);
                }
            }(document,"script","twitter-wjs");
        </script>

</div>
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body ">
                <address id="about" class="vcard body shadow">
                                <ul id="links">
                                    <li><a href="http://www.geo.hunter.cuny.edu/cfarmer/">CUNY Faculty Page</a></li>
                                    <li><a href="http://www.carsilab.org/">CARSI Lab</a></li>
                                </ul>
                Carson Farmer| Assistant Professor of GIScience | Department Geography</br>
                Hunter College - CUNY | 695 Park Avenue, New York | New York, 10065</br>
                </address><!-- /#about -->
                <p style="text-align: center;">This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, 
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41110370-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'carsonfarmer';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
    $(function() {
        var search = window.location.search.substring(1)
        if (search == "feed=rss2") window.location = "http://www.carsonfarmer.com/feeds/all.rss.xml"
    });

    $(document).ready(function() {
    
        //Calculate the height of <header>
        //Use outerHeight() instead of height() if have padding
        var aboveHeight = $('.navbar').position().top;

    //when scroll
        $(window).scroll(function() {
            //if scrolled down more than the header’s height
                if ($(window).scrollTop() > aboveHeight){
                // if yes, add "fixed" class to the <nav>
                // add padding top to the #content 
                    // if (!$('nav').hasClass('fixed')) {
                    //     $('.home_link').show("slide", { direction: "right" }, 250)
                    // };
                    $('.navbar').addClass('fixed').addClass('shadow').css('top','0').next() //.addClass('navbar-fixed-top').next()//
                    $('#content').css('margin-top',aboveHeight+20+'px'); // value is same as the height of the nav
                } else {
                // when scroll up or less than aboveHeight,
                // remove the “fixed” class, and the padding-top
                    // if ($('nav').hasClass('fixed')) {
                    //     console.log('test')
                    //     $('.home_link').hide("slide", { direction: "right" }, 250)
                    // };
                    $('.navbar').removeClass('fixed').removeClass('shadow').next()
                    $('#content').css('margin-top','0px');
                }
        });
        $("#top-query").keydown(function(event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                site_search();
                return false;
            }
        });
        $("#top-btn").click(function(event) {
            event.preventDefault();
            site_search();
            return false;
        });
    });
    
function site_search() {
    var query = $("#top-query").val();
    if (query == "") return false;
    var api = 'http://tapirgo.com/api/1/search.json?';
    var token = '51980cd33f61b05bbb000ce0';
    var el = $("#top-results");
    el.empty();
    el.append('<li style="padding-left: 10px">Fetching results...</li>')
    $.getJSON(api + 'token=' + token + '&query=' + query + '&callback=?', 
        function(data) {
            // insert function here if needed
            if (data.length) {
                el.empty();
                $.each(data, function(key, val) {
                    var xx = new Date(val.published_on)+""
                    if ((/^http\:\/\/www.carsonfarmer.com/).test(val.link)) { // hack to ignore duplicate returns
                        el.append('<li><a href="' + val.link + '" data-toggle="tooltip" data-placement="right" ' + 
                            'title="'+ xx.substring(0,15) + '">' + val.title + '</a>' + '</li>');
                    }
                });
            } else {
                el.empty();
                el.append('<li style="padding-left: 10px">No results found...</li>')
            };
        $("[data-toggle=tooltip]").tooltip();
    });
    $("#top-toggle").dropdown('toggle');
}
</script>
</body>
</html>