<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
<head>
        <meta charset="utf-8">
        <title>{% block title %}{{ SITENAME }}{%endblock%}</title>
        <link rel="stylesheet" href="{{ SITEURL }}/theme/css/{{ CSS_FILE }}">
        {% if FEED_ALL_ATOM %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Atom Feed" />
        {% endif %}
        {% if FEED_ALL_RSS %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} RSS Feed" />
        {% endif %}
        {% if article and article.latex %}
            {{ article.latex }}
        {% endif %}
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
        <script src="{{ SITEURL }}/libs/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="http://leaflet.cloudmade.com/dist/leaflet.js"></script>
        <link rel="stylesheet" href="http://leaflet.cloudmade.com/dist/leaflet.css" />
        <!--[if lte IE 8]><link rel="stylesheet" href="http://leaflet.cloudmade.com/dist/leaflet.ie.css" /><![endif]-->
        <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.3"></script>
        <!--<script src="http://twitter.github.io/bootstrap/assets/js/bootstrap-tooltip.js"></script>-->
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <script type="text/javascript">
            function initialize() {
                var layer = "watercolor";
                var map = new L.Map("map", {
                        center: new L.LatLng(40.67, -74.94),
                        zoom: 10,
                        zoomControl: false
                    });
                map.addLayer(new L.StamenTileLayer(layer, {opacity: 0.6}));
                
                map.locate({setView: true, watch: true})
                  .on('locationfound', function(e) {
                    var marker = L.marker([e.latitude, e.longitude]).bindPopup('Thanks for stopping by!');
                    map.addLayer(marker);
                  });
            }
        </script>
</head> 

<body id="index" class="home" onload="initialize()">
<div id="map" style="position: fixed;"></div>
{% include 'github.html' %}
        <header id="banner" class="body">
                <h1><a href="{{ SITEURL }}/">{{ SITENAME }} {% if SITESUBTITLE %} <strong>{{ SITESUBTITLE }}</strong>{% endif %}</a></h1>
                <form class="form-inline" id="top-search">
    <div class='input-append'>
        <input type="text" id="top-query" placeholder="Search..." />
        <button class="btn add-on" id="top-btn" type="button">
            <i class="icon-search"></i>
        </button>
<div class="dropdown pull-right" id="top-dropdown">
<a class="dropdown-toggle" id="top-toggle" role="button" data-toggle="dropdown" data-target="#" href="."></a>
<ul class="dropdown-menu pull-right" role="menu" id="top-results" aria-labelledby="top-toggle"></ul></div>
    </div>
</form>
                <div class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            {% if DISPLAY_HOME_ON_MENU -%}
                                <li><a id="home" href="{{ SITEURL }}/"><i class="icon-home"></i></a></li>
                                <li class="divider-vertical"></li>
                            {% endif %}
                            {% for title, link, icon in MENUITEMS %}
                                {% if link=='links' %}
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" id="{{ title }}-drop" role="button" href="#">
                                        <i class="{{ icon }}"></i> {{ title }}<i class="icon-chevron-down"></i></a>
                                        <ul class="dropdown-menu" role="menu" id="{{ title }}-menu" aria-labelledby="{{ title }}-drop">
                                            {% for title, link, icon in LINKS %}
                                                <li><a href="{{ SITEURL }}/{{ link }}"><i class="{{ icon }}"></i> {{ title }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% else %}
                                    <li><a href="{{ SITEURL }}/{{ link }}"><i class="{{ icon }}"></i> {{ title }}</a></li>
                                {% endif %}
                            {% endfor %}
                            {% if DISPLAY_PAGES_ON_MENU -%}
                                {% for page in PAGES %}
                                    <li><a href="{{ SITEURL }}/{{ page.url }}">{{ page.title }}</a></li>
                                {% endfor %}
                            {% endif %}
                            {% if DISPLAY_CATEGORIES_ON_MENU -%}
                                {% for cat, null in categories %}
                                    <li {% if cat == category %}class="active"{% endif %}>
                                        <a href="{{ SITEURL }}/{{ cat.url }}">{{ cat }}</a>
                                    </li>
                                {% endfor %}
                            {% endif %}
                            {% if SOCIAL or FEED_ALL_ATOM or FEED_ALL_RSS %}
                                <li class="dropdown pull-right">
                                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" id="social-drop" href="#">
                                    <i class="icon-group"></i> Social<i class="icon-chevron-down"></i></a>
                                    <ul class="dropdown-menu pull-right" role="menu" id="social-menu" aria-labelledby="social-drop">
                                        <li>
                                          <a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate">
                                          <i class="icon-rss"></i> atom feed</a>
                                        </li>
                                        {% if FEED_ALL_RSS %}
                                        <li>
                                          <a href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}" type="application/rss+xml" rel="alternate">
                                          <i class="icon-rss"></i> rss feed</a>
                                        </li>
                                        {% endif %}
                                        {% for name, link, icon in SOCIAL %}
                                            <li><a href="{{ link }}"><i class="{{ icon }}"></i> {{ name }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
        </header><!-- /#banner -->
        {% block content %}
        {% endblock %}
        <section id="extras" class="body shadow">
        {% if TWITTER_WIDGET_ID %}
            {% include 'twitter_feed.html' %}
        {% endif %}        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body ">
                <address id="about" class="vcard body shadow">
                                            {% if LINKS %}
                                <ul id="links">
                                    <li><a href="http://www.geo.hunter.cuny.edu/cfarmer/">CUNY Faculty Page</a></li>
                                    <li><a href="http://www.carsilab.org/">CARSI Lab</a></li>
                                </ul>
                            {% endif %}
                Carson Farmer| Assistant Professor of GIScience | Department Geography</br>
                Hunter College - CUNY | 695 Park Avenue, New York | New York, 10065</br>
                </address><!-- /#about -->
                <p style="text-align: center;">This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, 
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
        </footer><!-- /#contentinfo -->

{% include 'analytics.html' %}
{% include 'piwik.html' %}
{% include 'disqus_script.html' %}
<script>
    $(function() {
        var search = window.location.search.substring(1)
        if (search == "feed=rss2") window.location = "http://www.carsonfarmer.com/feeds/all.rss.xml"
    });

    $(document).ready(function() {
    
        //Calculate the height of <header>
        //Use outerHeight() instead of height() if have padding
        var aboveHeight = $('.navbar').position().top;

    //when scroll
        $(window).scroll(function() {
            //if scrolled down more than the header’s height
                if ($(window).scrollTop() > aboveHeight){
                // if yes, add "fixed" class to the <nav>
                // add padding top to the #content 
                    // if (!$('nav').hasClass('fixed')) {
                    //     $('.home_link').show("slide", { direction: "right" }, 250)
                    // };
                    $('.navbar').addClass('fixed').addClass('shadow').css('top','0').next() //.addClass('navbar-fixed-top').next()//
                    $('#content').css('margin-top',aboveHeight+20+'px'); // value is same as the height of the nav
                } else {
                // when scroll up or less than aboveHeight,
                // remove the “fixed” class, and the padding-top
                    // if ($('nav').hasClass('fixed')) {
                    //     console.log('test')
                    //     $('.home_link').hide("slide", { direction: "right" }, 250)
                    // };
                    $('.navbar').removeClass('fixed').removeClass('shadow').next()
                    $('#content').css('margin-top','0px');
                }
        });
        $("#top-query").keydown(function(event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                site_search();
                return false;
            }
        });
        $("#top-btn").click(function(event) {
            event.preventDefault();
            site_search();
            return false;
        });
    });
    
function site_search() {
    var query = $("#top-query").val();
    if (query == "") return false;
    var api = 'http://tapirgo.com/api/1/search.json?';
    var token = '51980cd33f61b05bbb000ce0';
    var el = $("#top-results");
    el.empty();
    el.append('<li style="padding-left: 10px">Fetching results...</li>')
    $.getJSON(api + 'token=' + token + '&query=' + query + '&callback=?', 
        function(data) {
            // insert function here if needed
            if (data.length) {
                el.empty();
                $.each(data, function(key, val) {
                    var xx = new Date(val.published_on)+""
                    if ((/^http\:\/\/www.carsonfarmer.com/).test(val.link)) { // hack to ignore duplicate returns
                        el.append('<li><a href="' + val.link + '" data-toggle="tooltip" data-placement="right" ' + 
                            'title="'+ xx.substring(0,15) + '">' + val.title + '</a>' + '</li>');
                    }
                });
            } else {
                el.empty();
                el.append('<li style="padding-left: 10px">No results found...</li>')
            };
        $("[data-toggle=tooltip]").tooltip();
    });
    $("#top-toggle").dropdown('toggle');
}
</script>
</body>
</html>
